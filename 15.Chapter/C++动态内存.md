## C++动态内存

C++ 程序中的内存分为两个部分：

* **栈**：在函数内部声明的所有变量都将占用栈内存。
* **堆**：这是程序中未使用的内存，在程序运行时可用于动态分配内存。

在 C++ 中，您可以使用特殊的运算符为给定类型的变量在运行时分配堆内的内存，这会返回所分配的空间地址。这种运算符即 new 运算符。

如果您不需要动态分配内存，可以使用 delete 运算符，删除之前由 new 运算符分配的内存。

### new和delete运算符

使用new运算符来为任意的数据类型动态分配内存的通用语法如下：

`new data-type;`

**data-type** 可以是包括数组在内的任意内置的数据类型，也可以是包括类或结构在内的用户自定义的任何煌类。

```
double *pvalue = NULL;
pvalue = new double;
```

如果自由存储区已被用完，可能无法成功的分配内存，所以建议检查new运算符是否返回NULL指针，并采取以下适当的操作

```
double *pvalue = NULL;
if (!(pvalue = new double)) {
	cout << "Error: out of memory." << endl;
	exit(1);
}

```

**malloc**函数在C语言中就出现了，C++中也可以使用，但是不建议使用**malloc**函数，**new**与**malloc**函数相比，其主要的优点是，new不只是分配了内存，还创建了对象

当觉得不再需要某个已经动态分配内存的变量的时候，可以使用**delete**操作符释放所占用的内存


`delete pvalue;`

## 数组的动态内存分配

假设我们要为一个字符数组（一个有 20 个字符的字符串）分配内存，我们可以使用上面实例中的语法来为数组动态地分配内存，如下所示：

```
char* pvalue  = NULL;   // 初始化为 null 的指针
pvalue  = new char[20]; // 为变量请求内存
```

要删除我们刚才创建的数组，语句如下:

```
delete [] pvalue;        // 删除 pvalue 所指向的数组
```

## 对象的动态内存分配

对象与简单的数据类型没有什么不同